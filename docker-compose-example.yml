version: "2"
services: 
  graphite:
    build: ./graphiteconfig
    restart: always
    ports:
        - "8080:80"
        - "8125:8125/udp"
        - "8126:8126"
        - "2003:2003"
        - "2004:2004"
    volumes: #Point to NDVP or local volumes
        - graphite-db-dev:/opt/graphite/storage/whisper
        #- /data/graphite-db:/opt/graphite/storage/whisper #This is a local volume
    networks:
        - net_sfcollector
  grafana:
    image: grafana/grafana
    restart: always
    ports:
        - "80:3000"
    volumes: #Point to NDVP or local volumes
        - grafana-dev:/var/lib/grafana
        #- grafana-conf:/etc/grafana
        #- /data/grafana:/var/lib/grafana #This is a local volume
    networks:
        - net_sfcollector
    environment: #Set password for Grafana web interface
        - GF_SECURITY_ADMIN_PASSWORD=<your password>
        - GF_SMTP_ENABLED=true
        - GF_SMTP_HOST=smtp.gmail.com:465
        - GF_SMTP_USER=<email address>
        - GF_SMTP_PASSWORD=<email password>
        - GF_SMTP_SKIP_VERIFY=true

  sfcollector-alpine:
    build: ./collector-alpine
    restart: always
    networks: 
        - net_sfcollector
  
  vsphere-collector:
    build: ./vsphere-graphite
    restart: always
    networks:
        - net_sfcollector
    depends_on: 
        - graphite

networks:
  net_sfcollector:
    driver: bridge

volumes:
  graphite-db-dev:
    external: true
  #grafana-conf:
  #  external: true
  grafana-dev:
    external: true

